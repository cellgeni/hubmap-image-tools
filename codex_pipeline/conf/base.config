
process {
    maxRetries = 2
    maxErrors = '-1'
    errorStrategy = 'terminate'
}

profiles {

    singularity_gpu {

        singularity {
            runOptions = "-B $CYTOKIT_DIR -B $HUBMAP_LZ"
        }

        process {
            withName: 'setup_data_directory' {
                container = "quay.io/mkeays/hubmap-image-tools"
            }

            withName: 'create_yaml_config' {
                container = "quay.io/mkeays/hubmap-image-tools"
            }
        }
    }

    singularity_cpu {

        singularity {
            runOptions = "--nv -B $CYTOKIT_DATADIR:/lab/data -B $CYTOKIT_DIR -B $HUBMAP_LZ"
        }

        process {
            withName: 'run_cytokit_processor' {
                container = "eczech/cytokit:latest"
            }
        }
    }
}
